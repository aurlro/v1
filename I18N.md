# Internationalization (i18n) System

This application features a lightweight, flexible internationalization system for supporting multiple languages.

## Overview

The i18n system consists of three main components:

1. **i18n.js** - Core translation engine with language switching and formatting utilities
2. **TranslationLoader.js** - Loads translation files and manages initialization
3. **Translation files** (JSON) - Organized translations in `assets/js/translations/`

## Getting Started

### 1. Initialize the System

In your main app.js file, initialize i18n after DOM content is loaded:

```javascript
// Initialize translations
TranslationLoader.initialize(['fr', 'en'], {
    defaultLanguage: 'fr',
    detectBrowser: true, // Auto-detect browser language
    onLanguageChange: (lang) => {
        console.log('Language changed to:', lang);
        // Re-render UI components if needed
    }
});

// Enable automatic page translation
TranslationLoader.enableAutoTranslate();

// Create language switcher UI
const languageSwitcher = TranslationLoader.createLanguageSwitcher();
document.getElementById('language-switcher-container').appendChild(languageSwitcher);
```

### 2. Translate Strings in Code

Use the `i18n.t()` function to get translated strings:

```javascript
// Simple translation
const message = i18n.t('messages.welcome'); // "Bienvenue !"

// Translation with parameters
const formatted = i18n.t('form.minLength', { length: 8 }); // "Minimum 8 caractères"

// Get all translations for current language
const allTranslations = i18n.getAll();
```

### 3. Translate HTML Elements

Add `data-i18n` attributes to elements that should be translated:

```html
<!-- Text translation -->
<h1 data-i18n="app.name"></h1>

<!-- Input placeholder translation -->
<input type="text" data-i18n="form.enterValue" placeholder>

<!-- With parameters -->
<p data-i18n="messages.welcome" data-i18n-params='{"name":"Jean"}'></p>
```

After language change, call `TranslationLoader.translatePage()` to update all elements.

## Translation Files

Translation files are JSON files located in `assets/js/translations/`.

### Structure

Each translation file follows this nested structure:

```json
{
  "app": {
    "name": "App Name",
    "description": "Description"
  },
  "navigation": {
    "home": "Home",
    "about": "About"
  },
  "messages": {
    "welcome": "Welcome!",
    "farewell": "Goodbye"
  },
  "form": {
    "minLength": "Minimum {length} characters"
  }
}
```

### Key Naming Conventions

- Use **dot notation** for nested keys: `app.name`, `navigation.home`
- Group related strings: `buttons`, `forms`, `messages`, `navigation`
- Use **camelCase** for keys
- Use **curly braces** for parameters: `{length}`, `{name}`

### Current Available Keys

#### app
- `name` - Application name
- `subtitle` - Application subtitle
- `description` - Application description

#### navigation
- `dashboard` - Dashboard page
- `journal` - Journal page
- `analyzeQuick` - Quick analysis page
- `analyzeManual` - Guided analysis page
- `analyzeAI` - AI analysis page
- `guide` - Guide & concepts page
- `insights` - Insights page

#### buttons
- `yes`, `no`, `ok`, `cancel`, `save`, `delete`, `edit`, `close`
- `newAnalysis`, `settings`, `help`, `search`
- `next`, `previous`, `submit`, `reset`

#### messages
- `welcome`, `goodbye`, `thanks`, `sorry`
- `confirmDelete`, `unsavedChanges`
- `saved`, `deleted`, `created`, `updated`, `copied`

#### form
- `required`, `optional`, `invalidEmail`, `invalidPhone`
- `passwordMismatch`, `enterValue`, `selectOption`
- `minLength`, `maxLength`

#### keyboard
- `help`, `shortcuts`, `searchOrCommand`
- `openCommandPalette`, `newQuickAnalysis`, `goToJournal`
- `showKeyboardHelp`, `closeModal`, `navigateItems`

#### notifications
- `tip`, `feature`, `success`, `error`, `warning`
- `noNotifications`

#### dojo, analyzer, onboarding
- Feature-specific translations

## API Reference

### Core Functions

#### `i18n.t(key, params)`
Get translated string with optional parameter interpolation.

```javascript
i18n.t('messages.welcome') // "Bienvenue !"
i18n.t('form.minLength', { length: 8 }) // "Minimum 8 caractères"
```

#### `i18n.tp(key, count, params)`
Get translated string with pluralization.

```javascript
i18n.tp('items.count', 5) // "{count} items"
```

#### `i18n.setLanguage(lang)`
Change current language and save preference.

```javascript
i18n.setLanguage('en'); // Switch to English
```

#### `i18n.getLanguage()`
Get current language code.

```javascript
const lang = i18n.getLanguage(); // 'fr' or 'en'
```

#### `i18n.getAvailableLanguages()`
Get list of available language codes.

```javascript
const languages = i18n.getAvailableLanguages(); // ['fr', 'en']
```

#### `i18n.formatDate(date, format)`
Format date according to current language locale.

```javascript
i18n.formatDate(new Date(), 'short') // "19/11/2025 14:30" (French)
```

#### `i18n.formatNumber(num, decimals)`
Format number according to current language locale.

```javascript
i18n.formatNumber(1234.56, 2) // "1 234,56" (French)
```

#### `i18n.formatList(items, conjunction)`
Format list with proper conjunction for language.

```javascript
i18n.formatList(['A', 'B', 'C'], 'and') // "A, B et C" (French)
```

### TranslationLoader Functions

#### `TranslationLoader.initialize(languages, options)`
Load translations and initialize i18n system.

Options:
- `defaultLanguage` - Fallback language (default: 'fr')
- `detectBrowser` - Auto-detect browser language (default: false)
- `onLanguageChange` - Callback when language changes

#### `TranslationLoader.translatePage()`
Translate all elements with `data-i18n` attributes on page.

#### `TranslationLoader.enableAutoTranslate()`
Listen for language changes and auto-translate page.

#### `TranslationLoader.createLanguageSwitcher()`
Create UI component for language selection.

## Adding New Languages

To add support for a new language:

1. **Create translation file**
   - Create `assets/js/translations/XX.json` (where `XX` is language code)
   - Copy structure from existing `en.json` or `fr.json`
   - Translate all keys

2. **Include in initialization**
   ```javascript
   TranslationLoader.initialize(['fr', 'en', 'es'], {
       defaultLanguage: 'fr'
   });
   ```

3. **Test**
   - Check all pages render correctly in new language
   - Verify parameters are interpolated properly
   - Test date/number formatting

## Example: Adding Spanish

1. Create `assets/js/translations/es.json`:
```json
{
  "app": {
    "name": "Caja de herramientas",
    "subtitle": "Comunicación",
    "description": "Herramienta para analizar y ayudar a la comunicación interpersonal"
  },
  ...
}
```

2. Update initialization:
```javascript
TranslationLoader.initialize(['fr', 'en', 'es']);
```

3. Use in app:
```javascript
i18n.t('app.name') // "Caja de herramientas"
```

## Best Practices

1. **Keep keys organized** - Use consistent grouping and naming
2. **Provide context** - Add comments for complex translations
3. **Test all paths** - Ensure translations work in all UI locations
4. **Use parameters** - Don't concatenate strings
5. **Plan for pluralization** - Use `tp()` for counts
6. **Locale awareness** - Use `formatDate()`, `formatNumber()` for proper formatting
7. **Context hints** - Add `title` or `aria-label` attributes with i18n keys
8. **Performance** - Load translation files asynchronously (default behavior)

## Common Patterns

### Conditional Translations
```javascript
if (user.notifications.length === 1) {
    message = i18n.t('notifications.single');
} else {
    message = i18n.tp('notifications.multiple', user.notifications.length);
}
```

### Dynamic Key Generation
```javascript
const status = 'success'; // or 'error', 'warning'
const message = i18n.t(`messages.${status}`);
```

### Using with Modules
```javascript
// In module initialization
const welcomeMsg = i18n.t('messages.welcome');
const confirmMsg = i18n.t('messages.confirmDelete');

// Re-translate on language change
window.addEventListener('languageChanged', () => {
    welcomeMsg = i18n.t('messages.welcome');
    confirmMsg = i18n.t('messages.confirmDelete');
    // Update UI
});
```

## Performance Considerations

- Translation files are loaded asynchronously
- Translations are cached in memory after loading
- Language changes are instant (no page reload needed)
- Use `requestAnimationFrame()` for large page translations

## Future Enhancements

- [ ] RTL (Right-to-Left) language support
- [ ] Currency formatting
- [ ] Timezone support
- [ ] Translation management UI
- [ ] Dynamic translation loading
- [ ] Server-side translation API integration
- [ ] Namespace support for code-splitting

## Troubleshooting

### Translations not showing
```javascript
// Check if i18n is initialized
console.log(i18n.getLanguage()); // Should return language code

// Check translation file loaded
console.log(i18n.getAll()); // Should show translations object

// Check key exists
console.log(i18n.t('nonexistent.key')); // Will log warning
```

### Parameters not interpolating
```javascript
// Wrong
i18n.t('message', { name: 'John' }); // Message doesn't use {name}

// Right
// In translation file: "Hello {name}"
i18n.t('message', { name: 'John' }); // "Hello John"
```

### Browser language not detected
```javascript
// Check navigator.language
console.log(navigator.language); // 'en-US', 'fr-FR', etc.

// Explicitly set
i18n.setLanguage('en');
```

## See Also

- ARCHITECTURE.md - System architecture overview
- Translation files in `assets/js/translations/`
- i18n.js - Core implementation
- TranslationLoader.js - Loader implementation
